---
name: Analysis
description: Run FEA/CFD analysis on CAD models using CalculiX and OpenFOAM
triggers:
  - analyze
  - analysis
  - fea
  - fem
  - stress
  - thermal
  - cfd
  - flow
  - simulate
  - structural
---

# Analysis Skill

Run finite element analysis (FEA) and computational fluid dynamics (CFD) on CAD models.

## Capabilities

- Structural analysis (stress, strain, displacement)
- Thermal analysis (heat transfer, temperature distribution)
- CFD (airflow, pressure drop) - future
- Mesh generation with Gmsh
- Results interpretation

## Usage

```
/analysis Run stress analysis on bracket.step with 100N load
/analysis Check thermal distribution with 50W heat source
/analysis Mesh the model with 2mm element size
```

## Prerequisites

Analysis requires Docker containers:

```bash
cd docker
docker-compose up analysis -d
```

## Workflow

### 1. Prepare Geometry

Ensure you have a STEP file from the CAD skill:
```
output/model.step
```

### 2. Generate Mesh (Gmsh)

Create a mesh file for FEA:

```python
import gmsh
import meshio

gmsh.initialize()
gmsh.open("output/model.step")

# Set mesh size
gmsh.option.setNumber("Mesh.CharacteristicLengthMax", 2.0)  # 2mm max

# Generate 3D mesh
gmsh.model.mesh.generate(3)

# Export for CalculiX
gmsh.write("output/model.inp")
gmsh.finalize()
```

Or via CLI:
```bash
gmsh output/model.step -3 -o output/model.inp -format inp
```

### 3. Set Up CalculiX Analysis

Create input file for structural analysis:

```
** CalculiX Input File
** Generated by Engineering Hub

*HEADING
Structural Analysis

*INCLUDE, INPUT=model.inp

** Material: Aluminum 6061
*MATERIAL, NAME=AL6061
*ELASTIC
68900, 0.33
*DENSITY
2700e-12

** Assign material to all elements
*SOLID SECTION, ELSET=EALL, MATERIAL=AL6061

** Boundary Conditions
*BOUNDARY
FIXED_NODES, 1, 3, 0

** Load: 100N in -Z direction
*CLOAD
LOAD_NODE, 3, -100

** Analysis Step
*STEP
*STATIC
*NODE FILE
U
*EL FILE
S, E
*END STEP
```

### 4. Run Analysis

```bash
# In Docker container
docker exec enghub-analysis ccx -i analysis

# Or native if installed
ccx -i analysis
```

### 5. Interpret Results

Read output files:
- `analysis.frd` - Results database (displacement, stress)
- `analysis.dat` - Summary output

Key values to extract:
- **Max Von Mises Stress**: Compare to material yield strength
- **Max Displacement**: Check if acceptable
- **Safety Factor**: Yield Strength / Max Stress

```python
# Parse .dat file for max stress
with open("analysis.dat") as f:
    content = f.read()
    # Extract max stress value
    # Report safety factor
```

### 6. Report Results

Provide to user:
- Max stress and location
- Max displacement and location
- Safety factor
- Pass/fail assessment
- Visualization suggestion (ParaView)

## Analysis Types

### Static Structural
```
*STEP
*STATIC
```
- Point loads, distributed loads
- Fixed constraints
- Linear elastic material

### Thermal
```
*STEP
*HEAT TRANSFER, STEADY STATE
```
- Heat sources
- Convection boundaries
- Temperature constraints

### Modal (Natural Frequencies)
```
*STEP
*FREQUENCY
10
```
- Find resonant frequencies
- Mode shapes

## Material Library

| Material | E (MPa) | ν | ρ (kg/m³) | Yield (MPa) |
|----------|---------|---|-----------|-------------|
| Aluminum 6061-T6 | 68,900 | 0.33 | 2,700 | 276 |
| Steel AISI 304 | 193,000 | 0.29 | 8,000 | 215 |
| PLA (3D Print) | 3,500 | 0.36 | 1,240 | 50 |
| ABS (3D Print) | 2,300 | 0.35 | 1,050 | 40 |
| Nylon | 2,700 | 0.40 | 1,150 | 75 |

## Files

- Dockerfile: `docker/Dockerfile.analysis`
- Mesh output: `output/*.inp`
- Results: `output/*.frd`, `output/*.dat`

## Future: CFD with OpenFOAM

When CFD is needed:
1. Generate STL from CAD
2. Create OpenFOAM case structure
3. Run simpleFoam or similar solver
4. Post-process with ParaView

This is Phase 3 work - not yet implemented.
